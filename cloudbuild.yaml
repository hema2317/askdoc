options:
  logging: CLOUD_LOGGING_ONLY

steps:
  # Step 0: Install Python dependencies
  - name: 'python:3.11'
    id: Install Dependencies
    entrypoint: bash
    args:
      - -c
      - |
        pip install --upgrade pip
        pip install -r requirements.txt

  # Step 1: Lint check (optional)
  - name: 'python:3.11'
    id: Lint Check
    entrypoint: bash
    args:
      - -c
      - |
        echo "Linting..."
        # Uncomment if flake8 is added to requirements.txt
        # flake8 .

  # Step 2: Confirm backend is OK
  - name: 'python:3.11'
    id: Confirm Setup
    entrypoint: bash
    args: ['-c', 'echo âœ… Flask backend setup validated in Cloud Build']

  # Step 3: Deploy to Cloud Run
  - name: 'gcr.io/cloud-builders/gcloud'
    id: Deploy to Cloud Run
    args:
      - 'run'
      - 'deploy'
      - 'askdoc-backend'               # <-- change to your service name
      - '--image'
      - 'gcr.io/$PROJECT_ID/askdoc-backend'  # <-- image name for deploy
      - '--region'
      - 'us-central1'                  # <-- or your chosen region
      - '--platform'
      - 'managed'
      - '--allow-unauthenticated'      # public access

images:
  - 'gcr.io/$PROJECT_ID/askdoc-backend'
